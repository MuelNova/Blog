---
title: "PWN Exploitation of exit_hook and Its Principles"
authors: [nova]
tags: [CTF, Pwn, CVE]
unlisted: true
---

### \_rtld_global

> - Arbitrary Write OG once
> - Write func + arg1 twice
> - Forge _\_rtld_global_ structure

#### Cause

In short, when _exit_ calls _\_dl_fini_, it will invoke _\_rtld_lock_lock_recursive_ and _\_rtld_lock_unlock_recursive_ for locking and unlocking. After these macros expand, they are respectively _\_rtld_global.\_dl_lock_lock_recursive(&\_rtld_global.\_dl_load_lock.mutex)_ and _\_rtld_global.\_dl_lock_unlock_recursive(&\_rtld_global.\_dl_load_lock.mutex)_

#### Usage

> ```
> libc-2.23 _rtld_global:0x5f0040   __rtld_lock_lock_recursive: 3848  __rtld_lock_unlock_recursive: 3856
> libc-2.27 _rtld_global:0x619060   __rtld_lock_lock_recursive: 3840  __rtld_lock_unlock_recursive: 3848
> libc-2.31 _rtld_global:0x23e060   __rtld_lock_lock_recursive: 3848  __rtld_lock_unlock_recursive: 3856
> ```

Modify _\_rtld_lock_lock_recursive/\_rtld_lock_unlock_recursive_ to OneGadget.

Or modify _\_rtld_lock_lock_recursive/\_rtld_lock_unlock_recursive_ to func, then modify _\_rtld_global.\_dl_load_lock.mutex_ to arg1.

:::info
This Content is generated by LLM and might be wrong / incomplete, refer to Chinese version if you find something wrong.
:::

<!-- AI -->
