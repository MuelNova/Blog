---
title: "Quick Guide: Installing Windows 11 with QEMU on a Docker Server"
date: 2024-10-26
authors: [nova]
---

You’ll need CPU host passthrough enabled (check `/proc/cpuinfo` for details).

Assuming QEMU and related packages are already installed, I won’t repeat those steps here.

<!--truncate-->

## Preparation

Download the Windows 11 ISO:

[Download Windows 11](https://www.microsoft.com/en-in/software-download/windows11)

Download the Virtio Windows driver ISO:

https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/

## Installation

### Create a qcow2 Disk

```bash
qemu-img create -f qcow2 windows11.qcow2 120G
```

### Start QEMU

Create a shell script (e.g., `run-win11.sh`):

```bash
#!/bin/sh

qemu-system-x86_64 \
  -enable-kvm \
  -smp 12,cores=6,threads=2 \
  -m 12G \
  -machine usb=on \
  -device usb-tablet \
  -cpu host \
  -vga virtio \
  -device e1000,netdev=net0 \
  -netdev user,id=net0,net=192.168.20.0/24,dhcpstart=192.168.20.20 \
  -drive file=windows11.qcow2,if=virtio \
  -drive file=virtio-win-0.1.262.iso,index=1,media=cdrom \
  -drive file=Windows.iso,index=2,media=cdrom \
  -vnc :1
```

- `Windows.iso` is the Windows 11 installation ISO.
- `windows11.qcow2` is the VM disk you created.
- `virtio-win-*.iso` is the Virtio driver ISO.

This command opens VNC on display `:1` (port 5901). I forwarded it over SSH:

```bash
ssh -L 5901:localhost:5901 root@<host> -p <port>
```

### Connect via VNC

On my Arch host, I used TigerVNC:

```bash
vncviewer localhost:5901
```

You should now see the Windows installer.

Next, bypass the TPM/Secure Boot/RAM checks:

1. In the installer, press Shift+F10 to open a Command Prompt.
2. Run `regedit` to open the Registry Editor.
3. Navigate to `HKEY_LOCAL_MACHINE\SYSTEM\Setup`.
4. Create a new key named `LabConfig`.
5. Under `LabConfig`, create three DWORD (32-bit) values and set them to `1`:
   - **BypassTPMCheck**
   - **BypassSecureBootCheck**
   - **BypassRAMCheck**

![Registry Editor](https://img.sysgeek.cn/img/2024/03/bypass-hardware-check-windows-11-p6.jpeg)

Continue the installer until you reach the disk selection screen. Click **Load Driver**, browse to the Virtio driver, and choose the correct architecture.

![Load Virtio Driver](https://oss.nova.gal/img/image-20241026172516934.png)

After loading the driver, your Virtio disk appears. Proceed with the installation as usual.

## References

- [Using QEMU to Try Windows 11 (Chinese)](https://linux.cn/article-13523-1.html)
- [Windows 11: 3 Easy Ways to Bypass TPM, CPU and Secure Boot Checks (Chinese)](https://www.sysgeek.cn/bypass-hardware-check-windows-11/)
- Internal team resources

:::info
This content is generated by LLM and might be wrong or incomplete. Refer to the original Chinese version if you encounter any issues.
:::

<!-- AI -->
